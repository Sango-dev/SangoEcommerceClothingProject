<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.w3.org/1999/xhtml"
        xmlns:sec="http://www.w3.org/1999/xhtml"
>
<head>
    <meta charset="UTF-8" />
    <title>ProductInstance Info</title>
    <head th:replace="fragments/header :: header-css">
    </head>
    <script>
        const ManSize = {
            XS: {
                chest: [86, 91],
                waist: [71, 76],
                hips: [86, 91],
                height: [0, 167],
            },
            S: {
                chest: [91, 96],
                waist: [76, 81],
                hips: [91, 96],
                height: [167, 173],
            },
            M: {
                chest: [96, 101],
                waist: [81, 86],
                hips: [96, 101],
                height: [173, 178],
            },
            L: {
                chest: [101, 106],
                waist: [86, 91],
                hips: [101, 106],
                height: [178, 183],
            },
            XL: {
                chest: [106, 111],
                waist: [91, 97],
                hips: [106, 111],
                height: [183, 188],
            },
            XXL: {
                chest: [116, 121],
                waist: [102, 107],
                hips: [117, 122],
                height: [188, 193],
            },
            "3XL": {
                chest: [127, 132],
                waist: [112, 117],
                hips: [127, 132],
                height: [193, Infinity],
            },
        };

        const WomenSize = {
            XS: {
                chest: [76, 81],
                waist: [56, 61],
                hips: [81, 86],
                height: [147, 157],
            },
            S: {
                chest: [81, 86],
                waist: [61, 66],
                hips: [86, 91],
                height: [157, 165],
            },
            M: {
                chest: [86, 91],
                waist: [66, 71],
                hips: [91, 96],
                height: [165, 170],
            },
            L: {
                chest: [91, 96],
                waist: [71, 76],
                hips: [96, 101],
                height: [170, 175],
            },
            XL: {
                chest: [96, 101],
                waist: [76, 81],
                hips: [101, 106],
                height: [175, 180],
            },
            XXL: {
                chest: [101, 106],
                waist: [81, 86],
                hips: [106, 111],
                height: [180, 185],
            },
            "3XL": {
                chest: [106, Infinity],
                waist: [86, Infinity],
                hips: [111, Infinity],
                height: [185, Infinity],
            },
        };

        function getSizeOver(chest, waist, hips, height, gender) {
            console.log(gender + "over");
            let arraySize;
            if (gender === "MALE") {
                arraySize = ManSize;
            } else {
                arraySize = WomenSize;
            }

            let closestSize;
            let closestDistance = Infinity;

            for (const [size, ranges] of Object.entries(arraySize)) {
                const chestRange = ranges.chest;
                const waistRange = ranges.waist;
                const hipsRange = ranges.hips;
                const heightRange = ranges.height;

                const chestDistance = Math.min(
                    Math.abs(chest - chestRange[0]),
                    Math.abs(chest - chestRange[1])
                );
                const waistDistance = Math.min(
                    Math.abs(waist - waistRange[0]),
                    Math.abs(waist - waistRange[1])
                );
                const hipsDistance = Math.min(
                    Math.abs(hips - hipsRange[0]),
                    Math.abs(hips - hipsRange[1])
                );
                const heightDistance = Math.min(
                    Math.abs(height - heightRange[0]),
                    Math.abs(height - heightRange[1])
                );

                const totalDistance =
                    chestDistance + waistDistance + hipsDistance + heightDistance;

                if (totalDistance < closestDistance) {
                    closestSize = size;
                    closestDistance = totalDistance;
                }
            }

            return closestSize;
        }

        function getSizeUnder(waist, hips, height, gender) {
            console.log(gender + "under");
            let arraySize;
            if (gender === "MALE") {
                arraySize = ManSize;
            } else {
                arraySize = WomenSize;
            }

            let closestSize;
            let closestDistance = Infinity;

            for (const [size, ranges] of Object.entries(arraySize)) {
                const waistRange = ranges.waist;
                const hipsRange = ranges.hips;
                const heightRange = ranges.height;

                const waistDistance = Math.min(
                    Math.abs(waist - waistRange[0]),
                    Math.abs(waist - waistRange[1])
                );
                const hipsDistance = Math.min(
                    Math.abs(hips - hipsRange[0]),
                    Math.abs(hips - hipsRange[1])
                );
                const heightDistance = Math.min(
                    Math.abs(height - heightRange[0]),
                    Math.abs(height - heightRange[1])
                );

                const totalDistance = waistDistance + hipsDistance + heightDistance;

                if (totalDistance < closestDistance) {
                    closestSize = size;
                    closestDistance = totalDistance;
                }
            }

            return closestSize;
        }

        function calculateSizeOver() {
            const chest = Number(document.getElementById("chest").value);
            const waist = Number(document.getElementById("waist").value);
            const hips = Number(document.getElementById("hips").value);
            const height = Number(document.getElementById("height").value);
            const gender = document.getElementById("gender").value;

            const sizeOver = getSizeOver(chest, waist, hips, height, gender);

            document.getElementById(
                "result"
            ).innerHTML = `${sizeOver}`;
        }

        function calculateSizeUnder() {
            const waist = Number(document.getElementById("waist").value);
            const hips = Number(document.getElementById("hips").value);
            const height = Number(document.getElementById("height").value);
            const gender = document.getElementById("gender").value;

            const sizeOver = getSizeUnder(waist, hips, height, gender);

            document.getElementById(
                "result"
            ).innerHTML = `${sizeOver}`;
        }
    </script>
</head>

<body>
<!-- Header -->
<div th:replace="fragments/header :: header"></div>
<!-- End Header -->

<!-- Tovar card -->
<div class="m-10 flex justify-between">
    <!--Info block-->
    <div class="bg-neutral-50">
        <!--Images-->
        <div class="flex">
            <img
                    th:src="@{${productInstance.linkOfFrontPicture}}"
                    src="https://picsum.photos/600/800"
                    class="w-[600px] h-[800px] p-2"
            />
            <img
                    th:src="@{${productInstance.linkOfBackPicture}}"
                    src="https://picsum.photos/600/800"
                    class="w-[600px] h-[800px] p-2"
            />
        </div>
        <!--End images-->

        <!--Description-->
        <div class="w-[1000px] p-10">
            <p th:text="${productInstance.product.description}" class="break-all">
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Unde minima
                maxime facilis est. Perferendis ipsa reiciendis tempora commodi
                accusamus, recusandae mollitia corrupti soluta sint eos, velit
                facilis nulla dignissimos cupiditate? Lorem ipsum dolor sit amet
                consectetur adipisicing elit. Doloribus distinctio ex hic architecto
                alias tempore unde quis consequatur in quos! Alias, ex dignissimos
                velit numquam assumenda odit ducimus aspernatur? Assumenda?
            </p>
            <p class="mt-3" th:text="${productInstance.product.composition}">
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Assumenda
                consequuntur cum officia, earum laborum rem porro eaque eveniet
                inventore! Perferendis doloremque sed commodi, ad voluptatem sunt
                labore quasi unde itaque.
            </p>
        </div>
        <!--End description-->
    </div>
    <!--End info block-->

    <!--Tovar info-->
    <div class="fixed right-10 bg-neutral-50 p-10 w-[600px]">
        <div class="flex justify-between">
            <div
                    th:text="${productInstance.product.title}"
                    class="text-xl font-bold"
            >
                Штани
            </div>
            <div class="flex items-center">
                <svg
                        aria-hidden="true"
                        class="w-5 h-5 text-black"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <title>20</title>
                    <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    ></path>
                </svg>
                <svg
                        aria-hidden="true"
                        class="w-5 h-5 text-black"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <title>40</title>
                    <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    ></path>
                </svg>
                <svg
                        aria-hidden="true"
                        class="w-5 h-5 text-black"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <title>60</title>
                    <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    ></path>
                </svg>
                <svg
                        aria-hidden="true"
                        class="w-5 h-5 text-black"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <title>80</title>
                    <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    ></path>
                </svg>
                <svg
                        aria-hidden="true"
                        class="w-5 h-5 text-gray-300"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <title>100</title>
                    <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                    ></path>
                </svg>
            </div>
        </div>

        <!--Price-->
        <div class="flex mt-10">
            <div th:text="${productInstance.product.price} + '₴'" class="mr-1">40</div>
        </div>
        <!--End Price-->

        <!--Select color-->
        <div class="flex mt-10">
            <div th:each="entry : ${productInstance.links}" class="ml-1">
                <a th:href="@{~/product/{id}/info(id=${entry.id})}">
              <span
                      th:text="${entry.colorDefinition}"
                      class="rounded-sm p-3 border-black border-[1px]"
              >
              </span>
                </a>
            </div>
        </div>
        <!--End select color-->

        <!--Select size add to card-->
        <form
                class="w-full flex flex-col mt-10"
                method="post"
                th:action="@{/product/{id}/add-to-cart(id=${productInstance.id})}"
        >
            <select name="size" class="p-3">
                <option hidden>Вибрати розмір</option>
                <option
                        class="p-3"
                        th:each="size : ${productInstance.sizes}"
                        th:value="${size.size}"
                >
                    <p th:text="${size.size}"></p>
                </option>
            </select>
            <button
                    type="submit"
                    class="mt-4 flex justify-center p-3 text-white bg-neutral-800 font-bold hover:opacity-50"
            >
                <div class="mr-1">Добавити в кошик</div>
                <div class="w-6 h-6">
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <title />
                        <path
                                fill="white"
                                d="M23.52,29h-15a5.48,5.48,0,0,1-5.31-6.83L6.25,9.76a1,1,0,0,1,1-.76H24a1,1,0,0,1,1,.7l3.78,12.16a5.49,5.49,0,0,1-.83,4.91A5.41,5.41,0,0,1,23.52,29ZM8,11,5.11,22.65A3.5,3.5,0,0,0,8.48,27h15a3.44,3.44,0,0,0,2.79-1.42,3.5,3.5,0,0,0,.53-3.13L23.28,11Z"
                        />
                        <path
                                fill="white"
                                d="M20,17a1,1,0,0,1-1-1V8a3,3,0,0,0-6,0v8a1,1,0,0,1-2,0V8A5,5,0,0,1,21,8v8A1,1,0,0,1,20,17Z"
                        />
                    </svg>
                </div>
            </button>
        </form>
        <!--End select size add to card-->

        <!--Choose size-->
        <div class="mt-5 w-full bg-neutral-200 bg-opacity-90 p-5">
            <div class="text-xl text-center font-bold m-1s">Калькулятор Розміру</div>
            <form class="flex flex-col gap-[10px]">
                <input
                        type="hidden"
                        th:value="${productInstance.product.gender}"
                        id="gender"
                        name="gender"
                />
                <div class="flex flex-col mx-1 mt-1 ">
                    <label
                            for="chest"
                            th:if="${productInstance.product.isUnderwear == false }"
                            class="tracking-wide p-1 hover:underline">Розмір грудей (в см):</label
                    >
                    <input
                            type="number"
                            id="chest"
                            name="chest"
                            required
                            th:if="${productInstance.product.isUnderwear == false }"
                            class="p-1 text-center outline-0"
                            min="0"
                    />
                </div>
                <div class="flex flex-col mx-1 mt-1 ">
                    <label for="waist" class="tracking-wide p-1 hover:underline">Обхват талії (в см):</label>
                    <input type="number" id="waist" name="waist" required min="0" class="p-1 text-center outline-0"/>
                </div>
                <div class="flex flex-col mx-1 mt-1 ">
                    <label for="hips" class="tracking-wide p-1 hover:underline">Розмір стегон (в см):</label>
                    <input type="number" id="hips" name="hips" required min="0" class="p-1 text-center outline-0"/>
                </div>
                <div class="flex flex-col mx-1 mt-1 ">
                    <label for="height" class="tracking-wide p-1 hover:underline">Вимірювання висоти (в см):</label>
                    <input type="number" id="height" name="height" required min="0" class="p-1 text-center outline-0"/>
                </div>
                 <input
                  th:if="${productInstance.product.isUnderwear == false }"
                  type="button"
                  onclick="calculateSizeOver()"
                  value="Розрахувати розмір"
                  class="bg-neutral-800 text-white py-2 mx-1 font-bold hover:opacity-50"
                />
                <input
                        th:if="${productInstance.product.isUnderwear == true }"
                        type="button"
                        onclick="calculateSizeUnder()"
                        value="Розрахувати розмір"
                        class="bg-neutral-800 text-white py-2 mx-1 font-bold hover:opacity-50"
                />
            </form>
            <div id="result" class="text-center underline text-4xl mt-3"></div>
        </div>
        <!--End Choose size-->
    </div>
    <!--End tovar info-->
</div>
<!-- End tovar card-->
</body>
</html>
