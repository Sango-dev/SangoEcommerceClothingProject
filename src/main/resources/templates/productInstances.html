<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.w3.org/1999/xhtml"
>
<head>
    <meta charset="UTF-8"/>
    <title>–¢–æ–≤–∞—Ä–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <head th:replace="fragments/header :: header-css">
    </head>
<body>
<div th:replace="fragments/header :: header"></div>
<div
        class="w-full bg-neutral-100 py-3 mb-10 sticky top-0 z-10 bg-opacity-90 flex"
>
    <form
            class="flex mx-5"
            id="filter-form"
            method="get"
            action="http://localhost:8080/product/filter/list"
    >
        <div class="flex mt-1">
            <div class="flex">
                <input class="hidden peer/draft" type="checkbox" name="genders" value="MALE" id="male-radio">
                <label class="mx-2 cursor-pointer peer-checked/draft:underline" for="male-radio">
                    –ß–æ–ª–æ–≤—ñ—á–∏–π –æ–¥—è–≥
                </label>
            </div>
            <div class="flex">
                <input class="hidden peer/draft" type="checkbox" name="genders" value="FEMALE" id="female-radio">
                <label class="mx-2 cursor-pointer peer-checked/draft:underline" for="female-radio">
                    –ñ—ñ–Ω–æ—á–∏–π –æ–¥—è–≥
                </label>
            </div>

            <div class="mx-10">
                <label for="sort">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</label>
                <select id="sort" name="sort">
                    <option value="non-sort">–í—ñ–¥—Å—É—Ç–Ω—î</option>
                    <option value="date_created_desc">
                        –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (—Å–ø–æ—á–∞—Ç–∫—É –Ω–∞–π–Ω–æ–≤—ñ—à—ñ)
                    </option>
                    <option value="date_created_asc">
                        –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (—Å–ø–æ—á–∞—Ç–∫—É –¥–∞–≤–Ω—ñ—à—ñ)
                    </option>
                    <option value="price_asc">–¶—ñ–Ω–∞ (–≤—ñ–¥ –Ω–∏–∑—å–∫–æ—ó –¥–æ –≤–∏—Å–æ–∫–æ—ó)</option>
                    <option value="price_desc">–¶—ñ–Ω–∞ (–≤—ñ–¥ –≤–∏—Å–æ–∫–æ—ó –¥–æ –Ω–∏–∑—å–∫–æ—ó)</option>
                </select>
            </div>
        </div>

        <div class="hidden none" id="hidden-filter">
            <div class="flex flex-col">
                <label for="brands">–ë—Ä–µ–Ω–¥–∏: </label>
                <select
                        class="mx-10"
                        value="urlParams.getAll('brands')"
                        id="brands"
                        name="brands"
                        multiple
                        size="7"
                >
                    <option
                            th:each="brand : ${brands}"
                            th:value="${brand.title}"
                            th:text="${brand.title}"
                            th:title="${brand.title}"
                    ></option>
                </select>
            </div>
            <div class="flex flex-col">
                <label for="categories">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó: </label>
                <select id="categories" class="mx-10" name="categories" multiple size="7">
                    <option
                            th:each="category : ${categories}"
                            th:value="${category.title}"
                            th:text="${category.title}"
                            th:title="${category.title}"
                    ></option>
                </select>
            </div>

            <div class="flex flex-col">
                <label for="sizes">–†–æ–∑–º—ñ—Ä–∏: </label>
                <select id="sizes" name="sizes" class="mx-10" multiple size="7">
                    <script>
                        const sizes = [
                            "XS",
                            "S",
                            "M",
                            "L",
                            "XL",
                            "XXL",
                            "3XL",
                        ];
                        sizes.forEach((size) => {
                            document.write(`<option value="${size}">${size}</option>`);
                        });
                    </script>
                </select>
            </div>

            <div class="flex flex-col">
                <label for="colors">–ö–æ–ª—å–æ—Ä–∏: </label>
                <select id="colors" name="colors" class="mx-10" multiple size="7">
                    <script>
                        const colors = {
                            "BLACK": "–ß–æ—Ä–Ω–∏–π",
                            "BLUE": "–°–∏–Ω—ñ–π",
                            "BROWN": "–ö–æ—Ä–∏—á–Ω–µ–≤–∏–π",
                            "GOLDCOLORED": "–ó–æ–ª–æ—Ç–∏—Å—Ç–∏–π",
                            "GREY": "–°—ñ—Ä–∏–π",
                            "GREEN": "–ó–µ–ª–µ–Ω–∏–π",
                            "MULTI": "–ë–∞–≥–∞—Ç–æ–∫–æ–ª—å–æ—Ä–æ–≤–∏–π",
                            "ORANGE": "–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π",
                            "PINK": "–†–æ–∂–µ–≤–∏–π",
                            "PURPLE": "–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π",
                            "RED": "–ß–µ—Ä–≤–æ–Ω–∏–π",
                            "SILVERCOLORED": "–°—Ä—ñ–±–Ω–∏–π",
                            "TURQUOISE": "–ë—ñ—Ä—é–∑–æ–≤–∏–π",
                            "WHITE": "–ë—ñ–ª–∏–π",
                            "YELLOW": "–ñ–æ–≤—Ç–∏–π",
                        };

                        for (const [key, value] of Object.entries(colors)) {
                            document.write(
                                `<option value="${key}" title="${value}">${value}</option>`
                            );
                        }
                    </script>
                </select>
            </div>
        </div>

        <button type="submit" class="mx-5 hover:underline">–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è</button>
    </form>
    <button type="reset" class="mx-5 hover:underline"><a th:href="@{~/product/list}">–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</a></button>
    <div class="flex ml-auto mr-10 text-xl">
        <form th:action="@{/product/search-by-param(code)}" method="get">
            <div class="flex items-center border-b border-black">
                <button class="flex-shrink-0 text-xl py-1 px-2" type="submit">
                    üîé
                </button>
                <input
                        class="appearance-none bg-transparent border-none w-full mr-3 py-1 px-2 leading-tight focus:outline-none"
                        type="search"
                        placeholder="–ü–æ—à—É–∫"
                        name="code"
                />
            </div>
        </form>
        <div class="pl-5 cursor-pointer" id="filter">
            üëáüèº
        </div>
    </div>
</div>

<!-- Card list -->
<div class="products_box w-screen flex justify-center">
    <div class="product_list w-fit grid grid-cols-4 gap-[5px]">
        <!-- Card  -->
        <div
                th:each="productInstance : ${productInstances}"
                class="product_card cursor-pointer w-full bg-white shadow-md hover:shadow-none hover:opacity-90"
        >
            <div
                    th:text="${productInstance.product.brand.title}"
                    class="absolute p-1 bg-black text-xl text-white"
            >
                H&M
            </div>
            <a th:href="@{~/product/{id}/info(id=${productInstance.getId()})}">
                <img
                        class="w-[400px] h-[600px]"
                        src="https://picsum.photos/400/500"
                        th:src="@{${productInstance.linkOfMainPicture}}"
                        th:alt="${productInstance.product.title}"
                />
            </a>
            <div class="h-[100px] p-2">
                <div
                        th:text="${productInstance.product.title}"
                        class="text-xl break-normal"
                >
                    –î–æ–≤–≥—ñ –¥–∂–∏–Ω—Å–∏
                </div>

                <div class="flex">
                    <div class="mr-1">–†–æ–∑–º—ñ—Ä–∏:</div>

                    <div th:each="size : ${productInstance.sizes}" class="flex">
                        <div th:text="${size.size}" class="mr-1">M</div>
                    </div>
                </div>

                <div
                        th:utext="${productInstance.product.price + ' ' + '‚Ç¥'}"
                        class="flex text-sm font-bold mt-2"
                >
                    –¶—ñ–Ω–∞ 100 –≥—Ä–Ω
                </div>
            </div>
        </div>
        <!-- End card -->
    </div>
</div>
<!-- End card list -->

<!-- Pagination -->
<div
        class="pagination flex justify-center mt-10 text-xl"
        th:if="${totalPages > 0}"
>
    <div class="w-fit flex">
        <div th:if="${currentPage > 0}">
            <a
                    class="px-2 cursor-pointer hover:underline"
                    th:href="@{${'/product/list?page=' + (currentPage - 1)}}"
                    aria-label="Previous"
            >
                <span aria-hidden="true">–Ω–∞–∑–∞–¥</span>
                <!-- back page -->
            </a>
        </div>
        <div
                th:each="page : ${#numbers.sequence(0, totalPages - 1)}"
                th:class="${currentPage == page ? 'active' : ''}"
        >
            <a
                    class="px-2 cursor-pointer hover:underline"
                    th:href="@{${'/product/list?page=' + page}}"
                    th:text="${page + 1}"
            ></a>
            <!-- current page -->
        </div>
        <div th:if="${currentPage < totalPages - 1}">
            <a
                    class="px-2 cursor-pointer hover:underline"
                    th:href="@{${'/product/list?page=' + (currentPage + 1)}}"
                    aria-label="Next"
            >
                <span aria-hidden="true">–¥–∞–ª—ñ</span>
                <!-- next page -->
            </a>
        </div>
    </div>
</div>
<!-- End pagination -->
</body>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const selectedBrands = urlParams.getAll("brands");
    const selectedCategories = urlParams.getAll("categories");
    const selectedSizes = urlParams.getAll("sizes");
    const selectedColors = urlParams.getAll("colors");
    const selectedGenders = urlParams.getAll("genders");
    const selectedSort = urlParams.getAll("sort");

    const brandsSelect = document.getElementById("brands");
    for (let i = 0; i < brandsSelect.options.length; i++) {
        if (selectedBrands.includes(brandsSelect.options[i].value)) {
            brandsSelect.options[i].selected = true;
        }
    }

    const categoriesSelect = document.getElementById("categories");
    for (let i = 0; i < categoriesSelect.options.length; i++) {
        if (selectedCategories.includes(categoriesSelect.options[i].value)) {
            categoriesSelect.options[i].selected = true;
        }
    }

    const sizesSelect = document.getElementById("sizes");
    for (let i = 0; i < sizesSelect.options.length; i++) {
        if (selectedSizes.includes(sizesSelect.options[i].value)) {
            sizesSelect.options[i].selected = true;
        }
    }

    const colorsSelect = document.getElementById("colors");
    for (let i = 0; i < colorsSelect.options.length; i++) {
        if (selectedColors.includes(colorsSelect.options[i].value)) {
            colorsSelect.options[i].selected = true;
        }
    }


    if (selectedGenders.includes('MALE')) {
        document.getElementById("male-radio").checked = true;
    }

    if (selectedGenders.includes('FEMALE')) {
        document.getElementById("female-radio").checked = true;
    }

    const sortSelect = document.getElementById("sort");
    for (let i = 0; i < sortSelect.options.length; i++) {
        if (selectedSort.includes(sortSelect.options[i].value)) {
            sortSelect.options[i].selected = true;
        }
    }

    const filterForm = document.querySelector("#filter");
    const filterBox = document.querySelector("#hidden-filter");
    filterForm.addEventListener("click", () => {
        let blockStyle = filterBox.style.display;
        if (blockStyle === "none") {
            blockStyle = "flex";
            filterForm.textContent = "üëÜüèº";
        } else {
            blockStyle = "none";
            filterForm.textContent = "üëáüèº";
        }
        filterBox.style.display = blockStyle;
    });
</script>
</html>