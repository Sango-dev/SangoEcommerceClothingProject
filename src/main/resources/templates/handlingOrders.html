<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.w3.org/1999/xhtml"
        xmlns:sec="http://www.w3.org/1999/xhtml"
>
<head>
    <meta charset="UTF-8" />
    <title>Handle Orders</title>
    <!-- <link rel="stylesheet" type="text/css" th:href="@{/css/orderhistorystyle.css}"/> -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<header
        class="w-full h-[80px] bg-neutral-200 grid justify-items-stretch grid-cols-3"
>
    <div sec:authorize="isAuthenticated()" class="my-auto px-2 text-2xl">
        Hello, <span sec:authentication="principal.username">Billi</span>
    </div>
    <div
            class="justify-self-center text-4xl my-auto text-red-500 font-mono font-bold"
    >
        SanGo
    </div>
    <div
            sec:authorize="isAuthenticated()"
            class="justify-self-end mx-2 my-auto text-2xl"
    >
        <a th:href="@{/logout}" class="mx-2">logout</a>
        <a th:href="@{/shop-cart}" class="basket mx-2 no-underline"> ðŸ›’ </a>
    </div>
</header>

<div class="w-full flex mb-10 text-xl">
    <a
            id="status-new"
            th:href="@{~/order/update-status?status=NEW}"
            class="m-1 px-3 cursor-pointer underline hover:no-underline"
    >
        New
    </a>
    <a
            id="status-processing"
            th:href="@{~/order/update-status?status=PROCESSING}"
            class="m-1 px-3 cursor-pointer underline hover:no-underline"
    >
        Processing
    </a>
    <a
            id="status-delivering"
            th:href="@{~/order/update-status?status=DELIVERING}"
            class="m-1 px-3 cursor-pointer underline hover:no-underline"
    >
        Delivering
    </a>
    <a
            id="status-canceled"
            th:href="@{~/order/update-status?status=CANCELED}"
            class="m-1 px-3 cursor-pointer underline hover:no-underline"
    >
        Canceled
    </a>
    <a
            id="status-completed"
            th:href="@{~/order/update-status?status=COMPLETED}"
            class="m-1 px-3 cursor-pointer underline hover:no-underline"
    >
        Completed
    </a>
</div>

<div id="sort-by" class="absolute left-[30px] top-[130px]">
    <div class="cursor-pointer" id="sort-text">Sort by ðŸ‘‡</div>
    <ul
            id="sort-params"
            class="flex flex-col list-disc"
            style="display: none"
    >
        <li><a id="sort-price-up"> Sort price up</a></li>
        <li><a id="sort-price-down"> Sort price down</a></li>
        <li><a id="sort-date-down"> Date newest</a></li>
        <li><a id="sort-date-up"> Date oldest</a></li>
    </ul>
</div>

<p id="hide-current-page" th:text="${currentPage}" style="display: none">
    kek
</p>
<div th:each="order : ${orders}" class="my-10">
    <table align="center" width="1500px">
        <thead class="text-xl bg-neutral-100">
        <tr>
            <th>CREATED</th>
            <th>RECIPIENT</th>
            <th>PHONE</th>
            <th>ADDRESS</th>
            <th>Email</th>
            <th>SUM</th>
            <th>STATUS</th>
            <th>UPDATED</th>
            <th>Update Status</th>
        </tr>
        </thead>

        <tbody class="border-b">
        <tr>
            <td align="center" th:text="${order.created}">created</td>
            <td align="center" th:text="${order.recipient}">recipient</td>
            <td align="center" th:text="${order.phone}">phone</td>
            <td align="center" th:text="${order.address}">address</td>
            <td align="center" th:text="${order.email}">email</td>
            <td align="center" th:text="${order.sum   + ' ' + '$'}">sum</td>
            <td align="center" th:text="${order.status}">status</td>
            <td align="center" th:text="${order.updated}">updated</td>
            <td align="center">
                <form action="/order/update-status" method="post">
                    <input
                            type="text"
                            name="id"
                            th:value="${order.id}"
                            style="display: none"
                    />
                    <select name="status">
                        <div th:if="${order.status.toString() != 'NEW'}">
                            <option>New</option>
                        </div>
                        <div th:if="${order.status.toString() != 'PROCESSING'}">
                            <option th:selected="${order.status.toString() == 'NEW'}">
                                Processing
                            </option>
                        </div>
                        <div th:if="${order.status.toString() != 'DELIVERING'}">
                            <option
                                    th:selected="${order.status.toString() == 'PROCESSING'}"
                            >
                                Delivering
                            </option>
                        </div>
                        <div th:if="${order.status.toString() != 'CANCELED'}">
                            <option>Canceled</option>
                        </div>
                        <div th:if="${order.status.toString() != 'COMPLETED'}">
                            <option
                                    th:selected="${order.status.toString() == 'DELIVERING'}"
                            >
                                Completed
                            </option>
                        </div>
                    </select>
                    <input type="submit" value="Update" />
                </form>
            </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td
                    colspan="9"
                    align="center"
                    id="show-details"
                    class="underline py-3 cursor-pointer hover:no-underline"
            >
                Show datails
            </td>
        </tr>
        </tfoot>
    </table>

    <div id="order-list" style="display: none">
        <table align="center" width="800px" class="border">
            <thead class="text-xl bg-neutral-200">
            <tr>
                <th>Pic</th>
                <th>Title</th>
                <th>Size</th>
                <th>Amount</th>
                <th>Price</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="detail : ${order.details}" class="border-b">
                <td align="center" class="w-[150px] h-auto p-3">
                    <img
                            th:src="@{${detail.linkOfMainPicture}}"
                            src="https://picsum.photos/200/300"
                    />
                </td>
                <td align="center" th:text="${detail.productInstanceTitle}">
                    title
                </td>
                <td align="center" th:text="${detail.size}">size</td>
                <td align="center" th:text="${detail.amount}">amount</td>
                <td align="center" th:text="${detail.price}">price</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!--&lt;!&ndash; Pagination &ndash;&gt;-->
<!-- <div
  class="pagination flex justify-center mt-10 text-xl"
  th:if="${totalPages > 0}"
>
  <div class="w-fit flex">
    <div th:if="${currentPage > 0}">
      <a aria-label="Previous" id="prev">
        <span aria-hidden="true">back</span>
      </a>
    </div>
    <div>
      <p th:text="${currentPage + 1 + ' - ' + totalPages}"></p>
    </div>

    <div th:if="${currentPage < totalPages - 1}">
      <a aria-label="Next" id="next">
        <span aria-hidden="true">next</span>
      </a>
    </div>
  </div>
</div> -->

<div
        class="pagination flex justify-center my-5 text-xl"
        th:if="${totalPages > 0}"
>
    <div class="w-fit flex">
        <div th:if="${currentPage > 0}">
            <a aria-label="Previous" id="prev" class="mx-1 hover:underline">
                <span aria-hidden="true">back</span>
                <!--back page-->
            </a>
        </div>
        <div>
            <div th:text="${currentPage + 1 + ' - ' + totalPages}" class="mx-1 cursor-pointer hover:underline">1</div>
        </div>
        <div th:if="${currentPage < totalPages - 1}">
            <a aria-label="Next" id="next" class="mx-1 hover:underline">
                <span aria-hidden="true">next</span>
                <!-- next page-->
            </a>
        </div>
    </div>
</div>
<!--&lt;!&ndash; End pagination &ndash;&gt;-->
</body>
<script>
    const urlParams = new URLSearchParams(window.location.search);

    const status = urlParams.get("status");

    if (status !== null) {
        localStorage.setItem("selectedStatus", status);
    }

    const selectedStatus = localStorage.getItem("selectedStatus");

    var linkPriceUp = document.getElementById("sort-price-up");
    linkPriceUp.href =
        "/order/update-status?status=" + selectedStatus + "&sort=sum-asc";

    var linkPriceDown = document.getElementById("sort-price-down");
    linkPriceDown.href =
        "/order/update-status?status=" + selectedStatus + "&sort=sum-desc";

    var linkDateDown = document.getElementById("sort-date-down");
    linkDateDown.href =
        "/order/update-status?status=" + selectedStatus + "&sort=date-desc";

    var linkDateUp = document.getElementById("sort-date-up");
    linkDateUp.href =
        "/order/update-status?status=" + selectedStatus + "&sort=date-asc";

    const statusNew = document.getElementById("status-new");
    const statusProcessing = document.getElementById("status-processing");
    const statusDelivering = document.getElementById("status-delivering");
    const statusCanceled = document.getElementById("status-canceled");
    const statusCompleted = document.getElementById("status-completed");

    // Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ»Ð¸Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¸
    statusNew.addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.setItem("selectedStatus", "NEW");
        window.location.href = statusNew.href;
    });

    statusProcessing.addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.setItem("selectedStatus", "PROCESSING");
        window.location.href = statusProcessing.href;
    });

    statusDelivering.addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.setItem("selectedStatus", "DELIVERING");
        window.location.href = statusDelivering.href;
    });

    statusCanceled.addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.setItem("selectedStatus", "CANCELED");
        window.location.href = statusCanceled.href;
    });

    statusCompleted.addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.setItem("selectedStatus", "COMPLETED");
        window.location.href = statusCompleted.href;
    });

    var linkPrev = document.getElementById("prev");
    var linkNext = document.getElementById("next");
    var currentPage = parseInt(
        document.getElementById("hide-current-page").textContent
    );

    if (urlParams.has("sort")) {
        const sort = urlParams.get("sort");
        if (linkPrev != null)
            linkPrev.href =
                "/order/update-status?status=" +
                selectedStatus +
                "&sort=" +
                sort +
                "&page=" +
                (currentPage - 1);
        if (linkNext != null)
            linkNext.href =
                "/order/update-status?status=" +
                selectedStatus +
                "&sort=" +
                sort +
                "&page=" +
                (currentPage + 1);
    } else {
        if (linkPrev != null)
            linkPrev.href =
                "/order/update-status?status=" +
                selectedStatus +
                "&page=" +
                (currentPage - 1);
        if (linkNext != null)
            linkNext.href =
                "/order/update-status?status=" +
                selectedStatus +
                "&page=" +
                (currentPage + 1);
    }
    const showDetails = document.querySelectorAll("#show-details");
    const orderList = document.querySelectorAll("#order-list");
    const sortBy = document.querySelector("#sort-by");
    const sortParams = document.querySelector("#sort-params");
    const sortText = document.querySelector("#sort-text");

    const textShowDetails = {
        show: "Show details",
        hide: "Hide",
    };
    const display = {
        flex: "inline",
        none: "none",
    };
    [...showDetails].forEach((item, index) => {
        item.addEventListener("click", () => {
            if (orderList[index].style.display === display.none) {
                orderList[index].style.display = display.flex;
                item.innerText = textShowDetails.hide;
            } else {
                orderList[index].style.display = display.none;
                item.innerText = textShowDetails.show;
            }
        });
    });

    sortBy.addEventListener("click", () => {
        if (sortParams.style.display === display.none) {
            sortParams.style.display = display.flex;
            sortText.innerText = "Sort byðŸ‘†";
        } else {
            sortParams.style.display = display.none;
            sortText.innerText = "Sort byðŸ‘‡";
        }
    });
</script>
</html>
